#!/usr/bin/env ruby

require 'open-uri'
require 'json'
require 'trollop'
require 'pp'
require 'colorize' # if verbose

require 'grailbird_updater'

opts = Trollop::options do
    version "updater #{GrailbirdUpdater::VERSION}"
    banner <<-EOS
Update your Twitter archive (best if used with a cron)

Usage: updater [options] [path to archive]

EOS
    opt :verbose, "Verbose mode"
    opt :prune, "Prune all but necessary user data from tweets", :default => true
    opt :limit, "How many tweets to look back at (max: 3200)", :default => 1000
    opt :directory, "Twitter archive directory", :type => :string
end

dir = nil
dir ||= opts[:directory]
dir ||= ARGV.first
dir ||= "."
raise ArgumentError, "Must specify a directory" unless File.directory?(dir)
raise ArgumentError, "Cannot look back further than 3200 tweets" if opts[:limit] > 3200

GrailbirdUpdater.new(dir, opts[:limit], opts[:verbose], opts[:prune]).update_tweets
